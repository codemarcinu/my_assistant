........FFFFF.sssssssssssssssssssFF..................................... [ 10%]
..............................................F......................... [ 20%]
.................................................Fs.sssssF
=================================== FAILURES ===================================
________________ test_search_integration_wikipedia_encyclopedic ________________
src/backend/tests/integration/test_search_integration.py:33: in test_search_integration_wikipedia_encyclopedic
    assert len(results) == 1
E   assert 5 == 1
E    +  where 5 = len([{'pageid': 126, 'snippet': '<span class="searchmatch">Albert</span> <span class="searchmatch">Einstein</span> (wym. [... class="searchmatch">einstein</span>) – jednostka liczności fotonów', 'source': 'wikipedia', 'title': 'Einstein', ...}])
----------------------------- Captured stdout call -----------------------------
{"timestamp": "2025-06-27T23:25:20.019175", "level": "INFO", "logger": "httpx", "module": "_client", "message": "HTTP Request: GET https://pl.wikipedia.org/w/api.php?action=query&format=json&list=search&srsearch=kto+to+Albert+Einstein&srlimit=5&srnamespace=0&srprop=snippet%7Ctitle%7Ctimestamp \"HTTP/1.1 200 OK\"", "levelno": 20, "taskName": "Task-37"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET https://pl.wikipedia.org/w/api.php?action=query&format=json&list=search&srsearch=kto+to+Albert+Einstein&srlimit=5&srnamespace=0&srprop=snippet%7Ctitle%7Ctimestamp "HTTP/1.1 200 OK"
____________________ test_search_integration_duckduckgo_web ____________________
src/backend/tests/integration/test_search_integration.py:66: in test_search_integration_duckduckgo_web
    assert len(results) == 2
E   assert 5 == 2
E    +  where 5 = len([{'pageid': 5720, 'snippet': 'Poniżej zaimplementowano algorytm sortowania bąbelkowego w C++ oraz w <span class="searc...a dwa razy dziennie – <span class="searchmatch">o</span> 18.00', 'source': 'wikipedia', 'title': 'Korona królów', ...}])
----------------------------- Captured stdout call -----------------------------
{"timestamp": "2025-06-27T23:25:20.621172", "level": "INFO", "logger": "httpx", "module": "_client", "message": "HTTP Request: GET https://api.duckduckgo.com/?q=szukaj+informacji+o+Pythonie&format=json&no_html=1&skip_disambig=1 \"HTTP/1.1 200 OK\"", "levelno": 20, "taskName": "Task-41"}
{"timestamp": "2025-06-27T23:25:21.201716", "level": "INFO", "logger": "httpx", "module": "_client", "message": "HTTP Request: GET https://pl.wikipedia.org/w/api.php?action=query&format=json&list=search&srsearch=szukaj+informacji+o+Pythonie&srlimit=5&srnamespace=0&srprop=snippet%7Ctitle%7Ctimestamp \"HTTP/1.1 200 OK\"", "levelno": 20, "taskName": "Task-41"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET https://api.duckduckgo.com/?q=szukaj+informacji+o+Pythonie&format=json&no_html=1&skip_disambig=1 "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: GET https://pl.wikipedia.org/w/api.php?action=query&format=json&list=search&srsearch=szukaj+informacji+o+Pythonie&srlimit=5&srnamespace=0&srprop=snippet%7Ctitle%7Ctimestamp "HTTP/1.1 200 OK"
__________________ test_search_integration_fallback_scenario ___________________
src/backend/tests/integration/test_search_integration.py:99: in test_search_integration_fallback_scenario
    assert len(results) == 1
E   assert 5 == 1
E    +  where 5 = len([{'pageid': 5901926, 'snippet': 'funkcji prosili stewardzi. [7] W tym tygodniu zespoły Moderator Tools i <span class="...jednym z elementów', 'source': 'wikipedia', 'title': 'Wikipedia:Poczekalnia/Załatwione artykuły (lipiec 2010/4)', ...}])
----------------------------- Captured stdout call -----------------------------
{"timestamp": "2025-06-27T23:25:21.657368", "level": "INFO", "logger": "httpx", "module": "_client", "message": "HTTP Request: GET https://pl.wikipedia.org/w/api.php?action=query&format=json&list=search&srsearch=wikipedia%3A+machine+learning&srlimit=5&srnamespace=0&srprop=snippet%7Ctitle%7Ctimestamp \"HTTP/1.1 200 OK\"", "levelno": 20, "taskName": "Task-45"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET https://pl.wikipedia.org/w/api.php?action=query&format=json&list=search&srsearch=wikipedia%3A+machine+learning&srlimit=5&srnamespace=0&srprop=snippet%7Ctitle%7Ctimestamp "HTTP/1.1 200 OK"
____________________ test_search_integration_error_recovery ____________________
src/backend/tests/integration/test_search_integration.py:131: in test_search_integration_error_recovery
    assert len(results) == 1
E   assert 5 == 1
E    +  where 5 = len([{'pageid': 58472, 'snippet': '<span class="searchmatch">Test</span> chi-kwadrat ( χ 2 ) {\\displaystyle \\left(\\chi ...cych wartości wariancji w populacji generalnej lub też do', 'source': 'wikipedia', 'title': 'Test dla wariancji', ...}])
----------------------------- Captured stdout call -----------------------------
{"timestamp": "2025-06-27T23:25:21.920446", "level": "INFO", "logger": "httpx", "module": "_client", "message": "HTTP Request: GET https://api.duckduckgo.com/?q=test+query&format=json&no_html=1&skip_disambig=1 \"HTTP/1.1 200 OK\"", "levelno": 20, "taskName": "Task-49"}
{"timestamp": "2025-06-27T23:25:22.317325", "level": "INFO", "logger": "httpx", "module": "_client", "message": "HTTP Request: GET https://pl.wikipedia.org/w/api.php?action=query&format=json&list=search&srsearch=test+query&srlimit=5&srnamespace=0&srprop=snippet%7Ctitle%7Ctimestamp \"HTTP/1.1 200 OK\"", "levelno": 20, "taskName": "Task-49"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET https://api.duckduckgo.com/?q=test+query&format=json&no_html=1&skip_disambig=1 "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: GET https://pl.wikipedia.org/w/api.php?action=query&format=json&list=search&srsearch=test+query&srlimit=5&srnamespace=0&srprop=snippet%7Ctitle%7Ctimestamp "HTTP/1.1 200 OK"
___________________ test_search_integration_prefix_override ____________________
src/backend/tests/integration/test_search_integration.py:157: in test_search_integration_prefix_override
    assert results[0]["title"] == "Search Results"
E   AssertionError: assert 'Wolfgang Pauli' == 'Search Results'
E     
E     - Search Results
E     + Wolfgang Pauli
----------------------------- Captured stdout call -----------------------------
{"timestamp": "2025-06-27T23:25:22.567938", "level": "INFO", "logger": "httpx", "module": "_client", "message": "HTTP Request: GET https://api.duckduckgo.com/?q=duck%3A+kto+to+Albert+Einstein&format=json&no_html=1&skip_disambig=1 \"HTTP/1.1 200 OK\"", "levelno": 20, "taskName": "Task-53"}
{"timestamp": "2025-06-27T23:25:23.123237", "level": "INFO", "logger": "httpx", "module": "_client", "message": "HTTP Request: GET https://pl.wikipedia.org/w/api.php?action=query&format=json&list=search&srsearch=duck%3A+kto+to+Albert+Einstein&srlimit=5&srnamespace=0&srprop=snippet%7Ctitle%7Ctimestamp \"HTTP/1.1 200 OK\"", "levelno": 20, "taskName": "Task-53"}
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1740 HTTP Request: GET https://api.duckduckgo.com/?q=duck%3A+kto+to+Albert+Einstein&format=json&no_html=1&skip_disambig=1 "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1740 HTTP Request: GET https://pl.wikipedia.org/w/api.php?action=query&format=json&list=search&srsearch=duck%3A+kto+to+Albert+Einstein&srlimit=5&srnamespace=0&srprop=snippet%7Ctitle%7Ctimestamp "HTTP/1.1 200 OK"
___________ TestMemoryProfilingIntegration.test_full_profiling_cycle ___________
src/backend/tests/performance/test_memory_profiling.py:276: in test_full_profiling_cycle
    with memory_profiling_context("integration_test") as profiler:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: '_AsyncGeneratorContextManager' object does not support the context manager protocol
__________ TestMemoryProfilingIntegration.test_async_profiling_cycle ___________
src/backend/tests/performance/test_memory_profiling.py:291: in test_async_profiling_cycle
    await profiler.take_snapshot_async()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'NoneType' object has no attribute 'take_snapshot_async'
______ TestIntegrationNewFeatures.test_search_agent_with_model_selection _______
src/backend/core/decorators.py:57: in sync_wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
src/backend/agents/agent_factory.py:211: in create_agent
    agent = agent_class(**kwargs)
            ^^^^^^^^^^^^^^^^^^^^^
E   TypeError: SearchAgent.__init__() got an unexpected keyword argument 'vector_store'

The above exception was the direct cause of the following exception:
src/backend/tests/test_integration_new_features.py:267: in test_search_agent_with_model_selection
    agent = agent_factory.create_agent("search")
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/backend/core/decorators.py:76: in sync_wrapper
    raise convert_to_custom_exception(e) from e
E   backend.core.exceptions.ProcessingError: Unexpected error: SearchAgent.__init__() got an unexpected keyword argument 'vector_store'
----------------------------- Captured stdout call -----------------------------
{"timestamp": "2025-06-27T23:25:39.603710", "level": "ERROR", "logger": "backend.core.decorators", "module": "decorators", "message": "Error in create_agent: SearchAgent.__init__() got an unexpected keyword argument 'vector_store'", "exception": "Traceback (most recent call last):\n  File \"/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/core/decorators.py\", line 57, in sync_wrapper\n    return func(*args, **kwargs)\n  File \"/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/agent_factory.py\", line 211, in create_agent\n    agent = agent_class(**kwargs)\nTypeError: SearchAgent.__init__() got an unexpected keyword argument 'vector_store'", "levelno": 40, "taskName": "Task-420"}
{"timestamp": "2025-06-27T23:25:39.606247", "level": "ERROR", "logger": "backend.core.decorators", "module": "decorators", "message": "Error in create_agent: SearchAgent.__init__() got an unexpected keyword argument 'vector_store'", "exception": "Traceback (most recent call last):\n  File \"/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/core/decorators.py\", line 57, in sync_wrapper\n    return func(*args, **kwargs)\n  File \"/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/agent_factory.py\", line 211, in create_agent\n    agent = agent_class(**kwargs)\nTypeError: SearchAgent.__init__() got an unexpected keyword argument 'vector_store'", "levelno": 40, "taskName": "Task-420"}
{"timestamp": "2025-06-27T23:25:39.609346", "level": "ERROR", "logger": "backend.core.exceptions", "module": "exceptions", "message": "FoodSave error: Unexpected error: SearchAgent.__init__() got an unexpected keyword argument 'vector_store'", "levelno": 40, "taskName": "Task-420", "error_code": "PROCESSING_ERROR", "severity": "high", "details": {}, "context": {}}
{"timestamp": "2025-06-27T23:25:39.609346", "level": "ERROR", "logger": "backend.core.exceptions", "module": "exceptions", "message": "FoodSave error: Unexpected error: SearchAgent.__init__() got an unexpected keyword argument 'vector_store'", "levelno": 40, "taskName": "Task-420", "error_code": "PROCESSING_ERROR", "severity": "high", "details": {}, "context": {}}
------------------------------ Captured log call -------------------------------
ERROR    backend.core.decorators:decorators.py:75 Error in create_agent: SearchAgent.__init__() got an unexpected keyword argument 'vector_store'
Traceback (most recent call last):
  File "/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/core/decorators.py", line 57, in sync_wrapper
    return func(*args, **kwargs)
  File "/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/agents/agent_factory.py", line 211, in create_agent
    agent = agent_class(**kwargs)
TypeError: SearchAgent.__init__() got an unexpected keyword argument 'vector_store'
ERROR    backend.core.exceptions:exceptions.py:33 FoodSave error: Unexpected error: SearchAgent.__init__() got an unexpected keyword argument 'vector_store'
_ TestMemoryMonitoringMiddleware.test_middleware_with_memory_profiling_enabled _
  + Exception Group Traceback (most recent call last):
  |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/middleware/base.py", line 177, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/_pytest/runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/_pytest/runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pluggy/_hooks.py", line 513, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     raise exception.with_traceback(exception.__traceback__)
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pluggy/_callers.py", line 122, in _multicall
    |     teardown.throw(exception)  # type: ignore[union-attr]
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/_pytest/logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pluggy/_callers.py", line 122, in _multicall
    |     teardown.throw(exception)  # type: ignore[union-attr]
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/_pytest/capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pluggy/_callers.py", line 122, in _multicall
    |     teardown.throw(exception)  # type: ignore[union-attr]
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/_pytest/skipping.py", line 263, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pluggy/_callers.py", line 103, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/_pytest/runner.py", line 178, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 508, in runtest
    |     super().runtest()
    |     ~~~~~~~~~~~~~~~^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/_pytest/python.py", line 1671, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pluggy/_hooks.py", line 513, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pluggy/_callers.py", line 182, in _multicall
    |     return outcome.get_result()
    |            ~~~~~~~~~~~~~~~~~~^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pluggy/_result.py", line 100, in get_result
    |     raise exc.with_traceback(exc.__traceback__)
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pluggy/_callers.py", line 103, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/_pytest/python.py", line 157, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/pytest_asyncio/plugin.py", line 773, in inner
    |     _loop.run_until_complete(task)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    |     return future.result()
    |            ~~~~~~~~~~~~~^^
    |   File "/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/tests/unit/test_memory_monitoring_middleware.py", line 112, in test_middleware_with_memory_profiling_enabled
    |     response = client.get("/test")
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/testclient.py", line 465, in get
    |     return super().get(
    |            ~~~~~~~~~~~^
    |         url,
    |         ^^^^
    |     ...<6 lines>...
    |         extensions=extensions,
    |         ^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 1053, in get
    |     return self.request(
    |            ~~~~~~~~~~~~^
    |         "GET",
    |         ^^^^^^
    |     ...<7 lines>...
    |         extensions=extensions,
    |         ^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/testclient.py", line 437, in request
    |     return super().request(
    |            ~~~~~~~~~~~~~~~^
    |         method,
    |         ^^^^^^^
    |     ...<11 lines>...
    |         extensions=extensions,
    |         ^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 825, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    |     response = self._send_handling_auth(
    |         request,
    |     ...<2 lines>...
    |         history=[],
    |     )
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |         request,
    |         follow_redirects=follow_redirects,
    |         history=history,
    |     )
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 1014, in _send_single_request
    |     response = transport.handle_request(request)
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/testclient.py", line 340, in handle_request
    |     raise exc
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/testclient.py", line 337, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |     ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/anyio/from_thread.py", line 290, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
    |   File "/home/marcin/miniconda3/lib/python3.13/concurrent/futures/_base.py", line 456, in result
    |     return self.__get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "/home/marcin/miniconda3/lib/python3.13/concurrent/futures/_base.py", line 401, in __get_result
    |     raise self._exception
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/anyio/from_thread.py", line 221, in _call_func
    |     retval = await retval_or_awaitable
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/fastapi/applications.py", line 1054, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/applications.py", line 112, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/middleware/errors.py", line 187, in __call__
    |     raise exc
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/middleware/base.py", line 176, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "/home/marcin/miniconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/middleware/base.py", line 178, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/core/middleware.py", line 162, in dispatch
    |     await profiler.log_memory_usage_async(
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    | AttributeError: 'NoneType' object has no attribute 'log_memory_usage_async'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/tests/unit/test_memory_monitoring_middleware.py", line 112, in test_middleware_with_memory_profiling_enabled
    response = client.get("/test")
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/testclient.py", line 465, in get
    return super().get(
           ~~~~~~~~~~~^
        url,
        ^^^^
    ...<6 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 1053, in get
    return self.request(
           ~~~~~~~~~~~~^
        "GET",
        ^^^^^^
    ...<7 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/testclient.py", line 437, in request
    return super().request(
           ~~~~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<11 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 825, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/testclient.py", line 340, in handle_request
    raise exc
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/testclient.py", line 337, in handle_request
    portal.call(self.app, scope, receive, send)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/anyio/from_thread.py", line 290, in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/miniconda3/lib/python3.13/concurrent/futures/_base.py", line 456, in result
    return self.__get_result()
           ~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/miniconda3/lib/python3.13/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/anyio/from_thread.py", line 221, in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/middleware/base.py", line 176, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "/home/marcin/miniconda3/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/home/marcin/miniconda3/lib/python3.13/site-packages/starlette/middleware/base.py", line 178, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/marcin/Dokumenty/agentai/makeit/AIASISSTMARUBO/src/backend/core/middleware.py", line 162, in dispatch
    await profiler.log_memory_usage_async(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'log_memory_usage_async'

During handling of the above exception, another exception occurred:
src/backend/tests/unit/test_memory_monitoring_middleware.py:112: in test_middleware_with_memory_profiling_enabled
    response = client.get("/test")
               ^^^^^^^^^^^^^^^^^^^
../../../../miniconda3/lib/python3.13/site-packages/starlette/testclient.py:465: in get
    return super().get(
../../../../miniconda3/lib/python3.13/site-packages/httpx/_client.py:1053: in get
    return self.request(
../../../../miniconda3/lib/python3.13/site-packages/starlette/testclient.py:437: in request
    return super().request(
../../../../miniconda3/lib/python3.13/site-packages/httpx/_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../miniconda3/lib/python3.13/site-packages/httpx/_client.py:914: in send
    response = self._send_handling_auth(
../../../../miniconda3/lib/python3.13/site-packages/httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
../../../../miniconda3/lib/python3.13/site-packages/httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../miniconda3/lib/python3.13/site-packages/httpx/_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../miniconda3/lib/python3.13/site-packages/starlette/testclient.py:340: in handle_request
    raise exc
../../../../miniconda3/lib/python3.13/site-packages/starlette/testclient.py:337: in handle_request
    portal.call(self.app, scope, receive, send)
../../../../miniconda3/lib/python3.13/site-packages/anyio/from_thread.py:290: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../miniconda3/lib/python3.13/concurrent/futures/_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
../../../../miniconda3/lib/python3.13/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
../../../../miniconda3/lib/python3.13/site-packages/anyio/from_thread.py:221: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
../../../../miniconda3/lib/python3.13/site-packages/fastapi/applications.py:1054: in __call__
    await super().__call__(scope, receive, send)
../../../../miniconda3/lib/python3.13/site-packages/starlette/applications.py:112: in __call__
    await self.middleware_stack(scope, receive, send)
../../../../miniconda3/lib/python3.13/site-packages/starlette/middleware/errors.py:187: in __call__
    raise exc
../../../../miniconda3/lib/python3.13/site-packages/starlette/middleware/errors.py:165: in __call__
    await self.app(scope, receive, _send)
../../../../miniconda3/lib/python3.13/site-packages/starlette/middleware/base.py:176: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
../../../../miniconda3/lib/python3.13/contextlib.py:162: in __exit__
    self.gen.throw(value)
../../../../miniconda3/lib/python3.13/site-packages/starlette/_utils.py:82: in collapse_excgroups
    raise exc
../../../../miniconda3/lib/python3.13/site-packages/starlette/middleware/base.py:178: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/backend/core/middleware.py:162: in dispatch
    await profiler.log_memory_usage_async(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'NoneType' object has no attribute 'log_memory_usage_async'
_______________________ test_model_fallback_and_recovery _______________________
src/backend/tests/unit/test_model_fallback_manager.py:9: in test_model_fallback_and_recovery
    model = await mgr.get_working_model()
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/backend/core/model_fallback_manager.py:47: in get_working_model
    raise ModelUnavailableError("No models are currently available")
E   backend.core.model_fallback_manager.ModelUnavailableError: No models are currently available
----------------------------- Captured stdout call -----------------------------
{"timestamp": "2025-06-27T23:25:43.830854", "level": "WARNING", "logger": "backend.core.model_fallback_manager", "module": "model_fallback_manager", "message": "No healthy models found", "levelno": 30, "taskName": "Task-753"}
{"timestamp": "2025-06-27T23:25:43.831072", "level": "WARNING", "logger": "backend.core.model_fallback_manager", "module": "model_fallback_manager", "message": "No healthy models found", "levelno": 30, "taskName": "Task-753"}
------------------------------ Captured log call -------------------------------
WARNING  backend.core.model_fallback_manager:model_fallback_manager.py:46 No healthy models found
=========================== short test summary info ============================
FAILED src/backend/tests/integration/test_search_integration.py::test_search_integration_wikipedia_encyclopedic
FAILED src/backend/tests/integration/test_search_integration.py::test_search_integration_duckduckgo_web
FAILED src/backend/tests/integration/test_search_integration.py::test_search_integration_fallback_scenario
FAILED src/backend/tests/integration/test_search_integration.py::test_search_integration_error_recovery
FAILED src/backend/tests/integration/test_search_integration.py::test_search_integration_prefix_override
FAILED src/backend/tests/performance/test_memory_profiling.py::TestMemoryProfilingIntegration::test_full_profiling_cycle
FAILED src/backend/tests/performance/test_memory_profiling.py::TestMemoryProfilingIntegration::test_async_profiling_cycle
FAILED src/backend/tests/test_integration_new_features.py::TestIntegrationNewFeatures::test_search_agent_with_model_selection
FAILED src/backend/tests/unit/test_memory_monitoring_middleware.py::TestMemoryMonitoringMiddleware::test_middleware_with_memory_profiling_enabled
FAILED src/backend/tests/unit/test_model_fallback_manager.py::test_model_fallback_and_recovery
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 10 failures !!!!!!!!!!!!!!!!!!!!!!!!!!
10 failed, 167 passed, 25 skipped, 59 warnings in 26.97s
