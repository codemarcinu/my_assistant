FROM ollama/ollama:latest

# Instalacja curl dla health check
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# Ustawienie zmiennych Å›rodowiskowych
ENV OLLAMA_HOST=0.0.0.0
ENV OLLAMA_KEEP_ALIVE=24h

# Ekspozycja portu
EXPOSE 11434

# Skrypt do automatycznego pobierania modeli
COPY <<EOF /usr/local/bin/init-models.sh
#!/bin/bash
set -e

echo "ðŸš€ Initializing Ollama models..."

# Pobieranie gÅ‚Ã³wnych modeli
echo "ðŸ“¥ Downloading Gemma 3 12B model..."
ollama pull gemma3:12b

echo "ðŸ“¥ Downloading Gemma 3 8B model..."
ollama pull gemma3:8b

echo "ðŸ“¥ Downloading Llama 3.2 3B model..."
ollama pull llama3.2:3b

echo "ðŸ“¥ Downloading Mistral 7B model..."
ollama pull mistral:7b

echo "ðŸ“¥ Downloading Nomic Embed Text model..."
ollama pull nomic-embed-text

echo "âœ… All models downloaded successfully!"

# Uruchomienie Ollama
exec ollama serve
EOF

# Nadanie uprawnieÅ„ do wykonywania skryptu
RUN chmod +x /usr/local/bin/init-models.sh

# Uruchomienie skryptu inicjalizacji
CMD ["/usr/local/bin/init-models.sh"] 